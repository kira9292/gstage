<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
  <div class="bg-white rounded-2xl shadow-2xl w-[90%] max-w-4xl max-h-[90vh] overflow-y-auto">
    <div class="p-6 border-b border-gray-200 flex justify-between items-center">
      <h2 class="text-2xl font-bold text-gray-800">Détails de la demande</h2>
      <button
        (click)="closeModal()"
        class="text-gray-500 hover:text-gray-800 transition-colors">
        <i class="fas fa-times text-2xl"></i>
      </button>
    </div>

    <div class="grid md:grid-cols-2 gap-6 p-6">
      <!-- Candidate Info -->
      <div>
        <h3 class="text-lg font-semibold mb-4 text-gray-700">Informations du Candidat</h3>
        <div class="space-y-3">
          <div class="flex items-center">
            <i class="fas fa-user mr-3 text-gray-500"></i>
            <span>{{ demande?.candidat?.firstName }} {{ demande?.candidat?.lastName }}</span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-graduation-cap mr-3 text-gray-500"></i>
            <span>{{ demande?.candidat?.formation }}</span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-school mr-3 text-gray-500"></i>
            <span>{{ demande?.candidat?.school }}</span>
          </div>
          <div *ngIf="demande?.demandeStage?.status == InternshipStatus.EN_COURS || demande?.demandeStage?.status == InternshipStatus.TERMINE">
            <i class="fas fa-list mr-2"></i>
            <span class="rounded-b-md hover:cursor-pointer transition-all duration-300 ease-in-out hover:scale-105 hover:text-blue-500" (click)="openAttestationModal()">Consulter les attestations de présence</span>
          </div>
          <div *ngIf="demande?.demandeStage?.status == InternshipStatus.EN_COURS || demande?.demandeStage?.status == InternshipStatus.TERMINE">
            <i class="fas fa-file mr-2"></i>
            <span class="rounded-b-md hover:cursor-pointer transition-all duration-300 ease-in-out hover:scale-105 hover:text-blue-500" (click)="downloadcontrat(demande?.candidat?.contrats[0])">Visualiser le contrat</span>
          </div>
          <div *ngIf="demande?.demandeStage?.status == InternshipStatus.TERMINE">
            <i class="fas fa-file mr-2"></i>
            <span class="rounded-b-md hover:cursor-pointer transition-all duration-300 ease-in-out hover:scale-105 hover:text-blue-500" (click)="downloadAttestationFindeStage(demande?.candidat?.attestationFinStage)">Visualiser l'attestation de fin de stage</span>
          </div>
        </div>
      </div>
      <div *ngIf="showAttestationModal " class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg w-[90%] max-w-6xl overflow-y-auto">
          <div class="p-6 border-b border-gray-200 flex justify-between items-center">
            <h2 class="text-2xl font-bold text-gray-800">Liste des Attestations de Présence</h2>
            <button
              (click)="closeAttestationModal()"
              class="text-gray-500 hover:text-gray-800 transition-colors"
            >
              <i class="fas fa-times text-2xl"></i>
            </button>
          </div>
          <div class="p-6 overflow-x-auto">
            <table class="min-w-full bg-white rounded-lg shadow">
              <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mois</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Période début</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Période fin</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date signature</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
              <tr *ngFor="let attestation of demande?.candidat?.attestationPresences" class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                  {{ getMonthFromDate(attestation.startDate) }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  {{ attestation.startDate | date: 'dd/MM/yyyy' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  {{ attestation.endDate | date: 'dd/MM/yyyy' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  {{ attestation.signatureDate | date: 'dd/MM/yyyy' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-4">
                  <button
                    (click)="viewAttestation(attestation)"
                    class="text-sonatel-orange hover:text-orange-600 transition-colors inline-flex items-center"
                    title="Voir l'attestation">
                    <i class="fas fa-eye h-5 w-5"></i>
                  </button>
                  <button
                    (click)="downloadDocument(attestation)"
                    class="text-sonatel-orange hover:text-orange-600 transition-colors inline-flex items-center"
                    title="Télécharger l'attestation">
                    <i class="fas fa-download h-5 w-5"></i>
                  </button>
                </td>

              </tr>
              </tbody>
            </table>
          </div>
          <div class="p-6 border-t border-gray-200 text-right">
            <button
              (click)="closeAttestationModal()"
              class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors"
            >
              Fermer
            </button>
          </div>
        </div>
      </div>

      <!-- Internship Details -->
      <div>
        <h3 class="text-lg font-semibold mb-4 text-gray-700">Détails de la Demande</h3>
        <div class="space-y-3">
          <div class="flex items-center">
            <i class="fas fa-file-alt mr-3 text-gray-500"></i>
            <span>Référence: {{ demande?.demandeStage?.reference }}</span>

          </div>
          <div class="flex items-center">
            <i class="fas fa-calendar-alt mr-3 text-gray-500"></i>
            <span>Date de début: {{ demande?.demandeStage?.startDate | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-calendar-check mr-3 text-gray-500"></i>
            <span>Date de fin: {{ demande?.demandeStage?.endDate | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="flex items-center">
            <i class="fas fa-info-circle mr-3 text-gray-500"></i>
            <span>
              Status:
              <span [ngClass]="getInternshipStatusClass(demande?.demandeStage?.status)">
                {{ getInternshipStatusLabel(demande?.demandeStage?.status) }}
              </span>
            </span>
          </div>


          <ng-container *ngIf="demande?.demandeStage?.status === InternshipStatus.PROPOSE ||
              demande?.demandeStage?.status === InternshipStatus.ACCEPTE">
              <div class="flex items-center">
              <i class="fas fa-building mr-3 text-gray-500"></i>
              <span>Service: {{ manager?.service }}</span>
              </div>
              <div class="flex items-center">
              <i class="fas fa-user-tie mr-3 text-gray-500"></i>
              <span>Manager: {{ manager?.firstName }} {{ manager?.lastName }}</span>
              </div>
          </ng-container>


        </div>
      </div>
    </div>

    <div class="p-6 border-t border-gray-200 flex space-x-4">
      <button
        *ngIf="canViewCV()"
        (click)="viewCV()"
        class="flex items-center bg-blue-100 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-200 transition-colors">
        <i class="fas fa-file-pdf mr-2"></i> Visualiser CV
      </button>
      <button
        *ngIf="canViewCoverLetter()"
        (click)="viewCoverLetter()"
        class="flex items-center bg-green-100 text-green-600 px-4 py-2 rounded-lg hover:bg-green-200 transition-colors">
        <i class="fas fa-envelope mr-2"></i> Visualiser Lettre de motivation
      </button>
    </div>

    <div class="p-6 border-t border-gray-200">
      <div [ngSwitch]="demande?.demandeStage?.status">
        <div *ngSwitchCase="InternshipStatus.EN_ATTENTE" class="flex space-x-4">
          <button
            (click)="proposeToManager()"
            class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
            <i class="fas fa-user-tie mr-2"></i> Proposer au manager
          </button>
          <button
            (click)="rejectApplication()"
            class="flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition-colors">
            <i class="fas fa-times-circle mr-2"></i> Rejeter
          </button>
        </div>

        <button
          *ngSwitchCase="InternshipStatus.ACCEPTE"
          (click)="sendWelcomeEmail()"
          class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">
          <i class="fas fa-envelope mr-2"></i> Generer Contrat et envoyer via mail
        </button>

        <div *ngSwitchCase="InternshipStatus.PROPOSE" class="flex space-x-4">
          <button
            (click)="proposeToManager()"
            class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
            <i class="fas fa-user-plus mr-2"></i> Proposer à un autre manager
          </button>
          <button
            (click)="cancelProposal()"
            class="flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition-colors">
            <i class="fas fa-ban mr-2"></i> Annuler la proposition
          </button>
        </div>

<!--        <button-->
<!--          *ngSwitchCase="InternshipStatus.EN_COURS"-->
<!--          (click)="scheduleEvaluation()"-->
<!--          class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors">-->
<!--          <i class="fas fa-calendar-check mr-2"></i> Générer attestation de présence-->
<!--        </button>-->

<!--        <button-->
<!--          *ngSwitchCase="InternshipStatus.TERMINE"-->
<!--          (click)="generateCertificate()"-->
<!--          class="w-full bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-700 transition-colors">-->
<!--          <i class="fas fa-certificate mr-2"></i> Générer attestation de fin de stage-->
<!--        </button>-->


        <div *ngSwitchCase="InternshipStatus.REFUSE" class="flex space-x-4">
          <button
            (click)="proposeToManager()"
            class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
            <i class="fas fa-user-tie mr-2"></i> Proposer a un autre manager
          </button>
          <button
            (click)="archiveApplication()"
            class="flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition-colors">
            <i class="fas fa-times-circle mr-2"></i> Archiver la demande
          </button>
        </div>


      </div>
    </div>
  </div>
</div>


